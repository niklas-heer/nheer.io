---
import { Image } from "astro:assets";
import BaseLayout from "../layouts/BaseLayout.astro";
import {
    fetchPodcastData,
    formatDuration,
    formatListeningTime,
    POCKETCASTS_START_DATE,
} from "../utils/database";

const data = await fetchPodcastData();
const stats = data?.stats;
const podcasts = data?.podcasts || [];
const podcastsByCategory = data?.podcastsByCategory || new Map();
const recentEpisodes = data?.recentEpisodes || [];
const inProgressEpisodes = data?.inProgressEpisodes || [];
const totalEpisodes = data?.totalEpisodes || 0;
const totalCompletedEpisodes = data?.totalCompletedEpisodes || 0;
const daysSinceStart = data?.daysSinceStart || 1;
const yesterdayStats = data?.yesterdayStats;
const monthlyStats = data?.monthlyStats || [];

// Calculate derived stats
const listeningTime = stats ? formatListeningTime(stats.timeListened) : null;
const timeSaved = stats
    ? formatListeningTime(
          stats.timeSilenceRemoval +
              stats.timeSkipping +
              stats.timeIntroSkipping +
              stats.timeVariableSpeed,
      )
    : null;

// Calculate averages
const totalHours = stats ? Math.round(stats.timeListened / 3600) : 0;
const avgMinutesPerDay = stats
    ? Math.round(stats.timeListened / 60 / daysSinceStart)
    : 0;
const avgHoursPerWeek = stats
    ? Math.round((stats.timeListened / 3600 / daysSinceStart) * 7 * 10) / 10
    : 0;

// Generate chart data for the current month
const now = new Date();
const daysInMonth = new Date(
    now.getFullYear(),
    now.getMonth() + 1,
    0,
).getDate();
const monthName = now.toLocaleDateString("en-US", { month: "long" });

// Helper to normalize date to YYYY-MM-DD string
function toDateString(date: string | Date): string {
    if (date instanceof Date) {
        return date.toISOString().split("T")[0];
    }
    return String(date).split("T")[0];
}

// Create array with all days of the month, filling in zeros for missing days
const chartData = Array.from({ length: daysInMonth }, (_, i) => {
    const day = i + 1;
    const dateStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
    const dayStats = monthlyStats.find((s) => toDateString(s.date) === dateStr);
    return {
        day,
        minutes: dayStats ? Math.round(dayStats.timeListened / 60) : 0,
        episodes: dayStats ? dayStats.episodesCompleted : 0,
    };
});

// Find max value for scaling the chart
const maxMinutes = Math.max(...chartData.map((d) => d.minutes), 60); // minimum 60 for scale

// Sort categories by total episodes listened (sum of all podcasts in category)
const sortedCategories = Array.from(podcastsByCategory.entries())
    .map(([category, categoryPodcasts]) => {
        const totalEpisodesInCategory = categoryPodcasts.reduce(
            (sum, p) => sum + (p.episodeCount || 0),
            0,
        );
        return {
            category,
            podcasts: categoryPodcasts,
            totalEpisodes: totalEpisodesInCategory,
        };
    })
    .sort((a, b) => b.totalEpisodes - a.totalEpisodes);

// Helper to format publish date
function formatPublishDate(dateStr: string | null): string {
    if (!dateStr) return "";
    const date = new Date(dateStr);
    return date.toLocaleDateString("en-US", {
        month: "short",
        day: "numeric",
        year: "numeric",
    });
}

// Helper to build episode URL
// Format: https://pocketcasts.com/podcast/{podcast_slug}/{podcast_uuid}/{episode_slug}/{episode_uuid}
function buildEpisodeUrl(episode: {
    podcastSlug?: string | null;
    podcastUuid: string;
    slug: string | null;
    uuid: string;
}): string {
    if (episode.podcastSlug && episode.slug) {
        return `https://pocketcasts.com/podcast/${episode.podcastSlug}/${episode.podcastUuid}/${episode.slug}/${episode.uuid}`;
    }
    // Fallback to podcast page if slugs are missing
    return `https://pocketcasts.com/podcast/${episode.podcastSlug || episode.podcastUuid}`;
}

// Helper to build podcast URL
function buildPodcastUrl(podcast: {
    slug: string | null;
    uuid: string;
}): string {
    if (podcast.slug) {
        return `https://pocketcasts.com/podcast/${podcast.slug}/${podcast.uuid}`;
    }
    return `https://pocketcasts.com/podcast/${podcast.uuid}`;
}

// Category icons/colors
const categoryStyles: Record<string, { color: string; icon: string }> = {
    Technology: { color: "#3b82f6", icon: "üíª" },
    "News & Politics": { color: "#ef4444", icon: "üì∞" },
    Business: { color: "#22c55e", icon: "üíº" },
    "Society & Culture": { color: "#a855f7", icon: "üåç" },
    "Personal Development": { color: "#f59e0b", icon: "üéØ" },
    "True Crime": { color: "#dc2626", icon: "üîç" },
    Education: { color: "#06b6d4", icon: "üìö" },
    "Health & Fitness": { color: "#10b981", icon: "üí™" },
    Science: { color: "#6366f1", icon: "üî¨" },
    History: { color: "#78716c", icon: "üìú" },
    Arts: { color: "#ec4899", icon: "üé®" },
    Comedy: { color: "#fbbf24", icon: "üòÑ" },
    Music: { color: "#8b5cf6", icon: "üéµ" },
    Gaming: { color: "#84cc16", icon: "üéÆ" },
    Sports: { color: "#f97316", icon: "‚öΩ" },
    Uncategorized: { color: "#6b7280", icon: "üìª" },
};
---

<BaseLayout
    title="Podcasts"
    description="My podcast listening stats and subscriptions"
>
    <h1
        class="text-3xl font-bold mb-2"
        style="view-transition-name: page-title;"
    >
        Podcasts
    </h1>
    <p class="text-muted mb-8">
        My podcast journey, tracked with <a
            href="https://pocketcasts.com"
            target="_blank"
            rel="noopener"
            class="text-accent hover:underline">Pocket Casts</a
        >.
    </p>

    {
        !data && (
            <div class="text-muted italic">
                Podcast data unavailable. Check back later!
            </div>
        )
    }

    {/* Stats Section */}
    {
        data && stats && (
            <section class="mb-12">
                {/* Main Stats */}
                <div class="stats-grid-main">
                    {/* Total Listening Time - Hero Stat */}
                    <div class="stat-card stat-hero">
                        <span class="stat-hero-number">
                            {totalHours.toLocaleString()}
                        </span>
                        <span class="stat-hero-unit">hours</span>
                        <span class="stat-hero-label">
                            total listening time
                        </span>
                        <span class="stat-hero-subtitle">
                            since Aug 2, 2015
                        </span>
                    </div>

                    {/* Yesterday's Listening */}
                    <div class="stat-card stat-yesterday">
                        {yesterdayStats ? (
                            <>
                                <span class="stat-yesterday-number">
                                    {Math.round(
                                        yesterdayStats.timeListened / 60,
                                    )}
                                </span>
                                <span class="stat-yesterday-unit">min</span>
                                <span class="stat-yesterday-label">
                                    yesterday
                                </span>
                                {yesterdayStats.episodesCompleted > 0 && (
                                    <span class="stat-yesterday-episodes">
                                        {yesterdayStats.episodesCompleted}{" "}
                                        {yesterdayStats.episodesCompleted === 1
                                            ? "episode"
                                            : "episodes"}{" "}
                                        finished
                                    </span>
                                )}
                            </>
                        ) : (
                            <>
                                <span class="stat-yesterday-number">--</span>
                                <span class="stat-yesterday-unit">min</span>
                                <span class="stat-yesterday-label">
                                    yesterday
                                </span>
                                <span class="stat-yesterday-episodes collecting">
                                    Collecting data...
                                </span>
                            </>
                        )}
                    </div>

                    {/* Daily Average */}
                    <div class="stat-card stat-average">
                        <span class="stat-avg-number">{avgMinutesPerDay}</span>
                        <span class="stat-avg-unit">min/day</span>
                        <span class="stat-avg-label">average</span>
                        <span class="stat-avg-weekly">
                            ~{avgHoursPerWeek}h per week
                        </span>
                    </div>

                    {/* Time Saved */}
                    <div class="stat-card stat-saved">
                        <span class="stat-saved-number">{timeSaved?.days}</span>
                        <span class="stat-saved-unit">days</span>
                        <span class="stat-saved-label">time saved</span>
                    </div>
                </div>

                {/* Secondary Stats */}
                <div class="stats-grid-secondary">
                    <div class="stat-mini">
                        <span class="stat-mini-value">{podcasts.length}</span>
                        <span class="stat-mini-label">subscriptions</span>
                    </div>
                    <div class="stat-mini">
                        <span class="stat-mini-value">
                            {totalCompletedEpisodes}
                        </span>
                        <span class="stat-mini-label">completed</span>
                    </div>
                    <div class="stat-mini">
                        <span class="stat-mini-value">{totalEpisodes}</span>
                        <span class="stat-mini-label">tracked</span>
                    </div>
                    <div class="stat-mini">
                        <span class="stat-mini-value">
                            {daysSinceStart.toLocaleString()}
                        </span>
                        <span class="stat-mini-label">days listening</span>
                    </div>
                </div>

                {/* Monthly Chart */}
                <div class="monthly-chart">
                    <h3 class="chart-title">Listening in {monthName}</h3>
                    <div class="chart-container">
                        <div class="chart-y-axis">
                            <span class="chart-y-label">
                                {maxMinutes > 0 ? maxMinutes : ""}
                            </span>
                            <span class="chart-y-label">
                                {maxMinutes > 0
                                    ? Math.round(maxMinutes / 2)
                                    : ""}
                            </span>
                            <span class="chart-y-label">0</span>
                        </div>
                        <div class="chart-bars">
                            {chartData.map(({ day, minutes }) => {
                                const height =
                                    maxMinutes > 0
                                        ? (minutes / maxMinutes) * 100
                                        : 0;
                                const isToday = day === now.getDate();
                                const isFuture = day > now.getDate();
                                return (
                                    <div
                                        class={`chart-bar-wrapper ${isToday ? "today" : ""} ${isFuture ? "future" : ""}`}
                                        title={`${day}: ${minutes} min`}
                                    >
                                        <div
                                            class="chart-bar"
                                            style={`height: ${height}%`}
                                        />
                                        {day % 5 === 1 && (
                                            <span class="chart-day-label">
                                                {day}
                                            </span>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                        {monthlyStats.length === 0 && (
                            <div class="chart-empty">
                                <span>
                                    Chart will populate as data is collected
                                </span>
                            </div>
                        )}
                    </div>
                </div>

                {/* Time Saved Breakdown */}
                <div class="time-saved-breakdown">
                    <h3 class="chart-title">Time Saved Breakdown</h3>
                    <div class="breakdown-grid">
                        <div class="breakdown-item">
                            <span class="breakdown-label">Silence Removal</span>
                            <span class="breakdown-value">
                                {
                                    formatListeningTime(
                                        stats.timeSilenceRemoval,
                                    ).total
                                }
                            </span>
                        </div>
                        <div class="breakdown-item">
                            <span class="breakdown-label">Variable Speed</span>
                            <span class="breakdown-value">
                                {
                                    formatListeningTime(stats.timeVariableSpeed)
                                        .total
                                }
                            </span>
                        </div>
                        <div class="breakdown-item">
                            <span class="breakdown-label">Skipping</span>
                            <span class="breakdown-value">
                                {formatListeningTime(stats.timeSkipping).total}
                            </span>
                        </div>
                        <div class="breakdown-item">
                            <span class="breakdown-label">Intro Skipping</span>
                            <span class="breakdown-value">
                                {
                                    formatListeningTime(stats.timeIntroSkipping)
                                        .total
                                }
                            </span>
                        </div>
                    </div>
                </div>
            </section>
        )
    }

    {/* Currently Listening */}
    {
        inProgressEpisodes.length > 0 && (
            <section class="mb-12">
                <h2 class="text-xl font-semibold mb-6 flex items-center gap-2">
                    <span class="inline-block w-3 h-3 bg-green rounded-full animate-pulse" />
                    Currently Listening
                </h2>

                <div class="episodes-list">
                    {inProgressEpisodes.map((episode) => {
                        const progress =
                            episode.duration > 0
                                ? Math.round(
                                      (episode.playedUpTo / episode.duration) *
                                          100,
                                  )
                                : 0;
                        return (
                            <a
                                href={buildEpisodeUrl(episode)}
                                target="_blank"
                                rel="noopener"
                                class="episode-card in-progress"
                            >
                                {episode.podcastImageUrl ? (
                                    <Image
                                        src={episode.podcastImageUrl}
                                        alt={
                                            episode.podcastTitle ||
                                            "Podcast cover"
                                        }
                                        width={48}
                                        height={48}
                                        class="episode-image"
                                        loading="lazy"
                                    />
                                ) : (
                                    <div class="episode-image-placeholder">
                                        <span>üéôÔ∏è</span>
                                    </div>
                                )}
                                <div class="episode-info">
                                    <h3 class="episode-title">
                                        {episode.title}
                                    </h3>
                                    <p class="episode-podcast">
                                        {episode.podcastTitle}
                                        {episode.publishedAt && (
                                            <span class="episode-date">
                                                {" "}
                                                ¬∑{" "}
                                                {formatPublishDate(
                                                    episode.publishedAt,
                                                )}
                                            </span>
                                        )}
                                    </p>
                                    <div class="progress-bar-container">
                                        <div
                                            class="progress-bar"
                                            style={`width: ${progress}%`}
                                        />
                                    </div>
                                    <p class="episode-progress-text">
                                        {formatDuration(episode.playedUpTo)} /{" "}
                                        {formatDuration(episode.duration)} (
                                        {progress}%)
                                    </p>
                                </div>
                            </a>
                        );
                    })}
                </div>
            </section>
        )
    }

    {/* Recent Episodes */}
    {
        recentEpisodes.length > 0 && (
            <section class="mb-12">
                <h2 class="text-xl font-semibold mb-6 flex items-center gap-2">
                    <span class="inline-block w-3 h-3 bg-accent rounded-full" />
                    Recently Listened
                </h2>

                <div class="episodes-list">
                    {recentEpisodes.slice(0, 10).map((episode) => (
                        <a
                            href={buildEpisodeUrl(episode)}
                            target="_blank"
                            rel="noopener"
                            class="episode-card"
                        >
                            {episode.podcastImageUrl ? (
                                <Image
                                    src={episode.podcastImageUrl}
                                    alt={
                                        episode.podcastTitle || "Podcast cover"
                                    }
                                    width={48}
                                    height={48}
                                    class="episode-image"
                                    loading="lazy"
                                />
                            ) : (
                                <div class="episode-image-placeholder">
                                    <span>üéôÔ∏è</span>
                                </div>
                            )}
                            <div class="episode-info">
                                <h3 class="episode-title">{episode.title}</h3>
                                <p class="episode-podcast">
                                    {episode.podcastTitle}
                                    {episode.publishedAt && (
                                        <span class="episode-date">
                                            {" "}
                                            ¬∑{" "}
                                            {formatPublishDate(
                                                episode.publishedAt,
                                            )}
                                        </span>
                                    )}
                                </p>
                            </div>
                            <div class="episode-meta">
                                <span class="episode-duration">
                                    {formatDuration(episode.duration)}
                                </span>
                                {episode.completed && (
                                    <span class="episode-completed">‚úì</span>
                                )}
                            </div>
                        </a>
                    ))}
                </div>
            </section>
        )
    }

    {/* Podcasts by Category */}
    {
        sortedCategories.length > 0 && (
            <section>
                <h2 class="text-xl font-semibold mb-6">
                    Subscriptions by Category
                </h2>

                <div class="categories-list">
                    {sortedCategories.map(
                        (
                            {
                                category,
                                podcasts: categoryPodcasts,
                                totalEpisodes: categoryEpisodes,
                            },
                            index,
                        ) => {
                            const style =
                                categoryStyles[category] ||
                                categoryStyles["Uncategorized"];
                            const isFirstCategory = index === 0;
                            return (
                                <details
                                    class="category-group"
                                    open={isFirstCategory}
                                >
                                    <summary class="category-header">
                                        <span class="category-icon">
                                            {style.icon}
                                        </span>
                                        <span class="category-name">
                                            {category}
                                        </span>
                                        <span class="category-count">
                                            {categoryPodcasts.length} podcasts
                                        </span>
                                        {categoryEpisodes > 0 && (
                                            <span class="category-episodes">
                                                {categoryEpisodes} episodes
                                            </span>
                                        )}
                                        <span class="category-chevron">
                                            <svg
                                                viewBox="0 0 24 24"
                                                fill="none"
                                                stroke="currentColor"
                                                stroke-width="2"
                                            >
                                                <polyline points="6 9 12 15 18 9" />
                                            </svg>
                                        </span>
                                    </summary>

                                    <div class="podcasts-grid">
                                        {categoryPodcasts.map((podcast) => (
                                            <a
                                                href={buildPodcastUrl(podcast)}
                                                target="_blank"
                                                rel="noopener"
                                                class="podcast-card"
                                            >
                                                {podcast.imageUrl ? (
                                                    <Image
                                                        src={podcast.imageUrl}
                                                        alt={podcast.title}
                                                        width={48}
                                                        height={48}
                                                        class="podcast-image"
                                                        loading="lazy"
                                                    />
                                                ) : (
                                                    <div class="podcast-image-placeholder">
                                                        <span>
                                                            {style.icon}
                                                        </span>
                                                    </div>
                                                )}
                                                <div class="podcast-info">
                                                    <h3 class="podcast-title">
                                                        {podcast.title}
                                                    </h3>
                                                    {podcast.author && (
                                                        <p class="podcast-author">
                                                            {podcast.author}
                                                        </p>
                                                    )}
                                                    {podcast.episodeCount &&
                                                        podcast.episodeCount >
                                                            0 && (
                                                            <p class="podcast-episodes">
                                                                {
                                                                    podcast.episodeCount
                                                                }{" "}
                                                                episodes
                                                                listened
                                                            </p>
                                                        )}
                                                </div>
                                            </a>
                                        ))}
                                    </div>
                                </details>
                            );
                        },
                    )}
                </div>
            </section>
        )
    }
</BaseLayout>

<style>
    /* Main Stats Grid */
    .stats-grid-main {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }

    @media (min-width: 640px) {
        .stats-grid-main {
            grid-template-columns: repeat(4, 1fr);
        }
    }

    .stat-card {
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 1rem;
        padding: 1.25rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
    }

    /* Hero Stat - Total Hours */
    .stat-hero {
        background: linear-gradient(
            135deg,
            var(--color-surface) 0%,
            color-mix(in srgb, var(--color-accent) 10%, var(--color-surface))
                100%
        );
    }

    .stat-hero-number {
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(
            135deg,
            var(--color-accent),
            var(--color-pink)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        line-height: 1;
    }

    .stat-hero-unit {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--color-muted);
        text-transform: uppercase;
        margin-left: 0.25rem;
    }

    .stat-hero-label {
        font-size: 0.65rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--color-muted);
        font-weight: 500;
        margin-top: 0.25rem;
    }

    .stat-hero-subtitle {
        font-size: 0.6rem;
        color: var(--color-muted);
        opacity: 0.7;
    }

    /* Yesterday Stat */
    .stat-yesterday-number {
        font-size: 2rem;
        font-weight: 700;
        color: var(--color-foreground);
        line-height: 1;
    }

    .stat-yesterday-unit {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--color-muted);
        text-transform: uppercase;
        margin-left: 0.125rem;
    }

    .stat-yesterday-label {
        font-size: 0.65rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--color-muted);
        font-weight: 500;
        margin-top: 0.25rem;
    }

    .stat-yesterday-episodes {
        font-size: 0.6rem;
        color: var(--color-green);
    }

    .stat-yesterday-episodes.collecting {
        color: var(--color-muted);
        font-style: italic;
    }

    /* Average Stat */
    .stat-avg-number {
        font-size: 2rem;
        font-weight: 700;
        color: var(--color-foreground);
        line-height: 1;
    }

    .stat-avg-unit {
        font-size: 0.7rem;
        font-weight: 600;
        color: var(--color-muted);
        text-transform: uppercase;
    }

    .stat-avg-label {
        font-size: 0.65rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--color-muted);
        font-weight: 500;
        margin-top: 0.25rem;
    }

    .stat-avg-weekly {
        font-size: 0.6rem;
        color: var(--color-muted);
        opacity: 0.7;
    }

    /* Saved Stat */
    .stat-saved-number {
        font-size: 2rem;
        font-weight: 700;
        color: var(--color-green);
        line-height: 1;
    }

    .stat-saved-unit {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--color-muted);
        text-transform: uppercase;
        margin-left: 0.125rem;
    }

    .stat-saved-label {
        font-size: 0.65rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--color-muted);
        font-weight: 500;
        margin-top: 0.25rem;
    }

    /* Secondary Stats Grid */
    .stats-grid-secondary {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 0.5rem;
        margin-top: 1rem;
    }

    .stat-mini {
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 0.5rem;
        padding: 0.75rem 0.5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .stat-mini-value {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--color-foreground);
        line-height: 1;
    }

    .stat-mini-label {
        font-size: 0.55rem;
        text-transform: uppercase;
        letter-spacing: 0.03em;
        color: var(--color-muted);
        font-weight: 500;
        margin-top: 0.25rem;
    }

    /* Monthly Chart */
    .monthly-chart {
        margin-top: 1.5rem;
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 1rem;
        padding: 1.5rem;
    }

    .chart-container {
        position: relative;
        height: 120px;
        display: flex;
        gap: 0.5rem;
    }

    .chart-y-axis {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: flex-end;
        height: calc(100% - 20px);
        padding-bottom: 20px;
        min-width: 30px;
    }

    .chart-y-label {
        font-size: 0.65rem;
        color: var(--color-text-muted);
        line-height: 1;
    }

    .chart-bars {
        display: flex;
        align-items: flex-end;
        height: 100%;
        gap: 2px;
        flex: 1;
    }

    .chart-bar-wrapper {
        flex: 1;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        position: relative;
    }

    .chart-bar {
        width: 100%;
        background: linear-gradient(
            180deg,
            var(--color-accent),
            var(--color-pink)
        );
        border-radius: 2px 2px 0 0;
        min-height: 2px;
        transition: height 0.3s ease;
    }

    .chart-bar-wrapper.today .chart-bar {
        background: var(--color-green);
    }

    .chart-bar-wrapper.future .chart-bar {
        background: var(--color-border);
        min-height: 1px;
    }

    .chart-day-label {
        position: absolute;
        bottom: -18px;
        font-size: 0.6rem;
        color: var(--color-muted);
    }

    .chart-empty {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--color-muted);
        font-size: 0.8rem;
        font-style: italic;
    }

    /* Time Saved Breakdown */
    .time-saved-breakdown {
        margin-top: 1.5rem;
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 1rem;
        padding: 1.5rem;
    }

    .chart-title {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--color-muted);
        font-weight: 600;
        margin-bottom: 1rem;
    }

    .breakdown-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }

    @media (min-width: 640px) {
        .breakdown-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }

    .breakdown-item {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .breakdown-label {
        font-size: 0.75rem;
        color: var(--color-muted);
    }

    .breakdown-value {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--color-foreground);
    }

    /* Episodes List */
    .episodes-list {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .episode-card {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem;
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 0.75rem;
        transition: all 0.2s ease;
        text-decoration: none;
    }

    .episode-card:hover {
        border-color: var(--color-accent);
        transform: translateX(4px);
    }

    .episode-image {
        width: 48px;
        height: 48px;
        border-radius: 0.5rem;
        object-fit: cover;
        flex-shrink: 0;
    }

    .episode-image-placeholder {
        width: 48px;
        height: 48px;
        border-radius: 0.5rem;
        background: var(--color-border);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        font-size: 1.25rem;
    }

    .episode-info {
        min-width: 0;
        flex: 1;
        overflow: hidden;
    }

    .episode-title {
        font-weight: 600;
        font-size: 0.9rem;
        color: var(--color-foreground);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .episode-podcast {
        font-size: 0.8rem;
        color: var(--color-muted);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .episode-meta {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-shrink: 0;
        margin-left: 0.5rem;
    }

    .episode-duration {
        font-size: 0.75rem;
        color: var(--color-muted);
        white-space: nowrap;
    }

    /* Progress bar for in-progress episodes */
    .episode-card.in-progress {
        flex-direction: row;
        align-items: flex-start;
    }

    .episode-card.in-progress .episode-info {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .progress-bar-container {
        width: 100%;
        height: 4px;
        background: var(--color-border);
        border-radius: 2px;
        overflow: hidden;
        margin-top: 0.5rem;
    }

    .progress-bar {
        height: 100%;
        background: linear-gradient(
            90deg,
            var(--color-accent),
            var(--color-pink)
        );
        border-radius: 2px;
        transition: width 0.3s ease;
    }

    .episode-progress-text {
        font-size: 0.7rem;
        color: var(--color-muted);
    }

    .episode-completed {
        color: var(--color-green);
        font-weight: bold;
    }

    .episode-date {
        color: var(--color-muted);
        font-size: 0.75rem;
    }

    /* Categories */
    .categories-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .category-group {
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 1rem;
    }

    .category-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 1rem 1.5rem;
        cursor: pointer;
        list-style: none;
        user-select: none;
    }

    .category-header::-webkit-details-marker {
        display: none;
    }

    .category-header:hover {
        background: var(--color-background);
        border-radius: 1rem;
    }

    .category-group[open] .category-header {
        border-radius: 1rem 1rem 0 0;
    }

    .category-icon {
        font-size: 1.25rem;
    }

    .category-name {
        font-weight: 600;
        color: var(--color-foreground);
    }

    .category-count {
        font-size: 0.7rem;
        color: var(--color-muted);
        background: var(--color-border);
        padding: 0.125rem 0.5rem;
        border-radius: 9999px;
    }

    .category-episodes {
        font-size: 0.7rem;
        color: var(--color-accent);
        background: color-mix(in srgb, var(--color-accent) 15%, transparent);
        padding: 0.125rem 0.5rem;
        border-radius: 9999px;
    }

    .category-chevron {
        margin-left: auto;
        width: 20px;
        height: 20px;
        color: var(--color-muted);
        transition: transform 0.2s ease;
    }

    .category-chevron svg {
        width: 100%;
        height: 100%;
    }

    .category-group[open] .category-chevron {
        transform: rotate(180deg);
    }

    .podcasts-grid {
        display: grid;
        grid-template-columns: repeat(1, 1fr);
        gap: 1rem;
        padding: 0 1.5rem 1.5rem 1.5rem;
    }

    @media (min-width: 480px) {
        .podcasts-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (min-width: 768px) {
        .podcasts-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    .podcast-card {
        display: flex;
        gap: 0.75rem;
        padding: 0.75rem;
        background: var(--color-background);
        border: 1px solid var(--color-border);
        border-radius: 0.75rem;
        transition: all 0.2s ease;
        text-decoration: none;
        overflow: hidden;
    }

    .podcast-card:hover {
        border-color: var(--color-accent);
    }

    .podcast-image {
        width: 48px;
        height: 48px;
        border-radius: 0.5rem;
        object-fit: cover;
        flex-shrink: 0;
    }

    .podcast-image-placeholder {
        width: 48px;
        height: 48px;
        border-radius: 0.5rem;
        background: var(--color-border);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        font-size: 1.25rem;
    }

    .podcast-info {
        min-width: 0;
        flex: 1;
        overflow: hidden;
    }

    .podcast-title {
        font-weight: 600;
        font-size: 0.85rem;
        color: var(--color-foreground);
        line-height: 1.2;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .podcast-author {
        font-size: 0.75rem;
        color: var(--color-muted);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .podcast-episodes {
        font-size: 0.7rem;
        color: var(--color-accent);
        margin-top: 0.25rem;
        white-space: nowrap;
    }
</style>
